!function(e){e.getScript=function(e,a){var t=document.createElement("script");t.async="async",t.src=e,a&&(t.onload=a),document.getElementsByTagName("head")[0].appendChild(t)}}($);var lego={};lego.setCookie=function(e,a){var t=new Date((new Date).getTime()+6e6),o=a+"; expires="+t.toUTCString();document.cookie=e+"="+o},lego.getCookie=function(e){var a=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return a?decodeURIComponent(a[1]):void 0},lego.getURLParameter=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},lego.geoLocation=function(e,a){Modernizr.geolocation?navigator.geolocation.getCurrentPosition(function(a){lego.setCookie("latitude",a.coords.latitude),lego.setCookie("longitude",a.coords.longitude),console.info("Location successfully determined."),lego.setCookie("geoLocationError","false"),e()},function(){console.warn("During detection location the error occurred."),lego.setCookie("geoLocationError","true"),a()}):(console.warn("During detection location the error occurred."),lego.setCookie("geoLocationError","true"),a())},lego.md5=function(e){function a(e,a){return e<<a|e>>>32-a}function t(e,a){var t,o,r,n,s;return r=2147483648&e,n=2147483648&a,t=1073741824&e,o=1073741824&a,s=(1073741823&e)+(1073741823&a),t&o?2147483648^s^r^n:t|o?1073741824&s?3221225472^s^r^n:1073741824^s^r^n:s^r^n}function o(e,a,t){return e&a|~e&t}function r(e,a,t){return e&t|a&~t}function n(e,a,t){return e^a^t}function s(e,a,t){return a^(e|~t)}function i(e,r,n,s,i,l,c){return e=t(e,t(t(o(r,n,s),i),c)),t(a(e,l),r)}function l(e,o,n,s,i,l,c){return e=t(e,t(t(r(o,n,s),i),c)),t(a(e,l),o)}function c(e,o,r,s,i,l,c){return e=t(e,t(t(n(o,r,s),i),c)),t(a(e,l),o)}function _(e,o,r,n,i,l,c){return e=t(e,t(t(s(o,r,n),i),c)),t(a(e,l),o)}function d(e){for(var a,t=e.length,o=t+8,r=(o-o%64)/64,n=16*(r+1),s=Array(n-1),i=0,l=0;t>l;)a=(l-l%4)/4,i=l%4*8,s[a]=s[a]|e.charCodeAt(l)<<i,l++;return a=(l-l%4)/4,i=l%4*8,s[a]=s[a]|128<<i,s[n-2]=t<<3,s[n-1]=t>>>29,s}function m(e){var a,t,o="",r="";for(t=0;3>=t;t++)a=e>>>8*t&255,r="0"+a.toString(16),o+=r.substr(r.length-2,2);return o}function p(e){e=e.replace(/\r\n/g,"\n");for(var a="",t=0;t<e.length;t++){var o=e.charCodeAt(t);128>o?a+=String.fromCharCode(o):o>127&&2048>o?(a+=String.fromCharCode(o>>6|192),a+=String.fromCharCode(63&o|128)):(a+=String.fromCharCode(o>>12|224),a+=String.fromCharCode(o>>6&63|128),a+=String.fromCharCode(63&o|128))}return a}var u,b,h,w,g,f,v,y,I,x=Array(),k=7,S=12,$=17,C=22,T=5,j=9,E=14,P=20,R=4,N=11,L=16,H=23,M=6,U=10,W=15,D=21;for(e=p(e),x=d(e),f=1732584193,v=4023233417,y=2562383102,I=271733878,u=0;u<x.length;u+=16)b=f,h=v,w=y,g=I,f=i(f,v,y,I,x[u+0],k,3614090360),I=i(I,f,v,y,x[u+1],S,3905402710),y=i(y,I,f,v,x[u+2],$,606105819),v=i(v,y,I,f,x[u+3],C,3250441966),f=i(f,v,y,I,x[u+4],k,4118548399),I=i(I,f,v,y,x[u+5],S,1200080426),y=i(y,I,f,v,x[u+6],$,2821735955),v=i(v,y,I,f,x[u+7],C,4249261313),f=i(f,v,y,I,x[u+8],k,1770035416),I=i(I,f,v,y,x[u+9],S,2336552879),y=i(y,I,f,v,x[u+10],$,4294925233),v=i(v,y,I,f,x[u+11],C,2304563134),f=i(f,v,y,I,x[u+12],k,1804603682),I=i(I,f,v,y,x[u+13],S,4254626195),y=i(y,I,f,v,x[u+14],$,2792965006),v=i(v,y,I,f,x[u+15],C,1236535329),f=l(f,v,y,I,x[u+1],T,4129170786),I=l(I,f,v,y,x[u+6],j,3225465664),y=l(y,I,f,v,x[u+11],E,643717713),v=l(v,y,I,f,x[u+0],P,3921069994),f=l(f,v,y,I,x[u+5],T,3593408605),I=l(I,f,v,y,x[u+10],j,38016083),y=l(y,I,f,v,x[u+15],E,3634488961),v=l(v,y,I,f,x[u+4],P,3889429448),f=l(f,v,y,I,x[u+9],T,568446438),I=l(I,f,v,y,x[u+14],j,3275163606),y=l(y,I,f,v,x[u+3],E,4107603335),v=l(v,y,I,f,x[u+8],P,1163531501),f=l(f,v,y,I,x[u+13],T,2850285829),I=l(I,f,v,y,x[u+2],j,4243563512),y=l(y,I,f,v,x[u+7],E,1735328473),v=l(v,y,I,f,x[u+12],P,2368359562),f=c(f,v,y,I,x[u+5],R,4294588738),I=c(I,f,v,y,x[u+8],N,2272392833),y=c(y,I,f,v,x[u+11],L,1839030562),v=c(v,y,I,f,x[u+14],H,4259657740),f=c(f,v,y,I,x[u+1],R,2763975236),I=c(I,f,v,y,x[u+4],N,1272893353),y=c(y,I,f,v,x[u+7],L,4139469664),v=c(v,y,I,f,x[u+10],H,3200236656),f=c(f,v,y,I,x[u+13],R,681279174),I=c(I,f,v,y,x[u+0],N,3936430074),y=c(y,I,f,v,x[u+3],L,3572445317),v=c(v,y,I,f,x[u+6],H,76029189),f=c(f,v,y,I,x[u+9],R,3654602809),I=c(I,f,v,y,x[u+12],N,3873151461),y=c(y,I,f,v,x[u+15],L,530742520),v=c(v,y,I,f,x[u+2],H,3299628645),f=_(f,v,y,I,x[u+0],M,4096336452),I=_(I,f,v,y,x[u+7],U,1126891415),y=_(y,I,f,v,x[u+14],W,2878612391),v=_(v,y,I,f,x[u+5],D,4237533241),f=_(f,v,y,I,x[u+12],M,1700485571),I=_(I,f,v,y,x[u+3],U,2399980690),y=_(y,I,f,v,x[u+10],W,4293915773),v=_(v,y,I,f,x[u+1],D,2240044497),f=_(f,v,y,I,x[u+8],M,1873313359),I=_(I,f,v,y,x[u+15],U,4264355552),y=_(y,I,f,v,x[u+6],W,2734768916),v=_(v,y,I,f,x[u+13],D,1309151649),f=_(f,v,y,I,x[u+4],M,4149444226),I=_(I,f,v,y,x[u+11],U,3174756917),y=_(y,I,f,v,x[u+2],W,718787259),v=_(v,y,I,f,x[u+9],D,3951481745),f=t(f,b),v=t(v,h),y=t(y,w),I=t(I,g);var z=m(f)+m(v)+m(y)+m(I);return z.toLowerCase()},lego.checkAuth=function(e,a){var t=lego.getCookie("sid");null===t||void 0===t?e():$.ajax({type:"GET",url:"/api/v1/user/me?sid="+t,dataType:"json",success:function(t){"invalid session"===t.error?e():a(t)},error:function(a,t){e(),console.error(a,t)}})},lego.userInfo_init=function(){$(".b-user").html('<div class="b-user__item b-user__avatar b-user__avatar_small"><img class="b-user__avatar__img" src="http://www.gravatar.com/avatar/'+localStorage.getItem("emailHash")+'?s=30&d=mm"/></div><div class="b-user__item b-user__name">'+localStorage.getItem("displayname")+'</div><div class="b-user__item b-user__profile b-user__profile_header"><a class="b-link b-user__profile__link" href="/profile">Profile</a></div><div class="b-user__item b-user__logout"><a class="b-link b-user__logout__link" href="/logout">Logout</a></div>'),$(".b-user__logout__link").on("click",function(){return lego.setCookie("sid",null),localStorage.email=null,localStorage.objectId=null,localStorage.fullname=null,localStorage.displayname=null,localStorage.location=null,localStorage.emailHash=null,document.location="/",!1})},lego.userLoginForm=function(){$(".b-button_user").on("click",function(){var e={email:$(".b-form__input_email").val(),password:$(".b-form__input_password").val()};return $.ajax({type:"GET",url:"/api/v1/user/login?ZW1haWw="+encodeURIComponent(window.btoa(e.email))+"&cGFzc3dvcmQ="+encodeURIComponent(window.btoa(e.password)),dataType:"json",success:function(e){null!=e.error||void 0!=e.error?$(".b-form__error").addClass("b-form__error_visible").html('<span class="b-form__error__descr">Invalid email or password</span>'):(lego.setCookie("sid",e.sessionToken),localStorage.emailHash=lego.md5(e.username),localStorage.email=e.username,localStorage.objectId=e.objectId,$.ajax({type:"GET",url:"http://www.gravatar.com/"+localStorage.emailHash+".json?callback=?",dataType:"jsonp",success:function(e){'"User not found"'!=e?(localStorage.fullname=e.entry[0].name.formatted,localStorage.displayname=e.entry[0].displayName,localStorage.location=e.entry[0].currentLocation):localStorage.displayname=localStorage.email,document.location="/"},error:function(){localStorage.email=e.username,localStorage.displayname=localStorage.email,document.location="/"}}))},error:function(){$(".b-form__error").addClass("b-form__error_visible").html('<span class="b-form__error__descr">Something is wrong, try again.</span>')}}),!1})},lego.userSignupForm=function(){$(".b-button_user").on("click",function(){$(".b-form__error").removeClass("b-form__error_visible");var e={email:$(".b-form__input_email").val(),password:$(".b-form__input_password").val(),fullname:$(".b-form__input_fullname").val()};return""==e.email||""==e.password?$(".b-form__error").addClass("b-form__error_visible").html('<span class="b-form__error__descr">Invalid email or password</span>'):$.ajax({type:"POST",url:"/api/v1/user/signup?ZW1haWw="+encodeURIComponent(window.btoa(e.email))+"&cGFzc3dvcmQ="+encodeURIComponent(window.btoa(e.password))+"&ZnVsbG5hbWU="+encodeURIComponent(window.btoa(e.fullname)),dataType:"json",success:function(e){null!=e.error||void 0!=e.error?$(".b-form__error").addClass("b-form__error_visible").html('<span class="b-form__error__descr">Invalid email or password</span>'):(lego.setCookie("sid",e.sessionToken),localStorage.emailHash=lego.md5(e.username),localStorage.email=e.username,localStorage.objectId=e.objectId,$.ajax({type:"GET",url:"http://www.gravatar.com/"+localStorage.emailHash+".json?callback=?",dataType:"jsonp",success:function(e){'"User not found"'!=e?(localStorage.fullname=e.entry[0].name.formatted,localStorage.displayname=e.entry[0].displayName,localStorage.location=e.entry[0].currentLocation):localStorage.displayname=localStorage.email,document.location="/"},error:function(){localStorage.email=e.username,localStorage.displayname=localStorage.email,document.location="/"}}))},error:function(){$(".b-form__error").addClass("b-form__error_visible").html('<span class="b-form__error__descr">Something is wrong, try again.</span>')}}),!1})},lego.userProfile=function(){var e='<div class="b-user__head">\n    <div class="b-user__avatar b-user__avatar_page">\n        <a target="_blank" href="http://www.gravatar.com" title="Change your avatar at Gravatar"><img\n                src="http://www.gravatar.com/avatar/{emailHash}?s=200&d=mm" class="b-user__avatar__img"/></a>\n    </div>\n    <div class="b-user__name b-user__name_page"><span class="b-user__name__displayname">{displayname}</span> <span\n            class="b-user__name__fullname">{fullname}</span></div>\n</div>\n<div class="b-user__profile">\n    <div class="b-user__profile__row">\n        <div class="b-user__profile__item">\n            <span class="b-user__profile__item__title">Email:</span>\n            <span class="b-user__profile__item__content">{email}</span>\n        </div>\n        <div class="b-user__profile__item">\n            <span class="b-user__profile__item__title">Preferred location:</span>\n            <span class="b-user__profile__item__content">{location}</span>\n        </div>\n    </div>\n    <div class="b-user__profile__row">\n        <div class="b-user__profile__item">\n            <span class="b-user__profile__item__title">Preferred location:</span>\n            <span class="b-user__profile__item__content">{location}</span>\n        </div>\n    </div>\n</div> ',a=e.replace("{emailHash}",localStorage.getItem("emailHash")).replace("{displayname}",localStorage.getItem("displayname")).replace("{email}",localStorage.getItem("email")).replace("{location}",localStorage.getItem("location")).replace("{fullname}","null"===localStorage.getItem("fullname")?"":localStorage.getItem("fullname"));$(".b-content__placeholder").html(a)},lego.mapLoad=function(e,a,t){google.maps.event.addDomListener(window,"load",lego.mapInit(e,a,t))},lego.mapInit=function(e,a,t){var o={zoom:13,center:new google.maps.LatLng(e,a),disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.TERRAIN};lego.mapInitParams=new google.maps.Map(document.getElementById(t),o)},lego.chcontainer_init=function(){$(".b-chcontainer__item_loc").click(function(){return $(".b-chcontainer__item__img_geoloc").attr("src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTAiIGhlaWdodD0iMTEwIj48Y2lyY2xlIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI1NS4xMzgiIGN5PSI1Ni4xMTciIHI9IjQxLjMwNCIgZmlsbD0ibm9uZSIvPjxsaW5lIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSIxOC44NzUiIHkxPSI1Ni4xMzUiIHgyPSI0Ljg3NSIgeTI9IjU2LjEzNSIgZmlsbD0ibm9uZSIvPjxsaW5lIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSI5MS44NzUiIHkxPSI1Ni4xMzUiIHgyPSIxMDQuODc1IiB5Mj0iNTYuMTM1IiBmaWxsPSJub25lIi8+PGxpbmUgc3Ryb2tlPSIjNEQ0RDREIiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjU0Ljg3NSIgeTE9IjE5LjEzNSIgeDI9IjU0Ljg3NSIgeTI9IjYuMTM1IiBmaWxsPSJub25lIi8+PGxpbmUgc3Ryb2tlPSIjNEQ0RDREIiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjU0Ljg3NSIgeTE9IjkzLjEzNSIgeDI9IjU0Ljg3NSIgeTI9IjEwNi4xMzUiIGZpbGw9Im5vbmUiLz48Y2lyY2xlIGZpbGw9IiNmMDAiIHN0cm9rZT0iI2YwMCIgc3Ryb2tlLXdpZHRoPSIuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgY3g9IjU1LjEzOCIgY3k9IjU2LjExNyIgcj0iMTcuMzkxIi8+PC9zdmc+"),void 0===lego.getCookie("latitude")||void 0===lego.getCookie("longitude")?lego.geoLocation(function(){document.location.href="/location"},function(){document.location.href="/location"}):(lego.setCookie("geoLocationError","false"),document.location.href="/location"),!1}),$(".b-chcontainer__item_search").click(function(){return $(".b-chcontainer__item_search").addClass("b-chcontainer__item_invis"),$(".b-chcontainer__item__form").addClass("b-chcontainer__item_vis"),!1})},lego.search_init=function(){var e=lego.getURLParameter("q");$(".b-search__q").text(e),document.searchf.q.value=e,$.ajax({type:"GET",url:"/api/search/"+e,dataType:"json",success:function(e){200==e.cod?($(".b-weather__locname_city").text(e.name),0===e.count?lego.search_error():1===e.count&&(document.location.href="/city/"+e.list[0].id),$.each(e.list,function(e,a){var t='<div class="b-wlist__line"><div class="b-wlist__line__head"><a class="b-wlist__link" href="/city/{itemid}">{itemname}<a/> <span class"b-wlist__country">{itemcountry}</span></div><div class="b-wlist__line__content"><span class="b-wlist__temp">{itemtemp}℃</span> <span class="b-wlist__sky">{itemweather}</span></div></div>',o=t.replace("{itemid}",a.id).replace("{itemname}",a.name).replace("{itemcountry}",a.sys.country).replace("{itemtemp}",a.main.temp.toFixed(1)).replace("{itemweather}",a.weather[0].main);$(o).appendTo(".b-wlist")}),$(".b-loader").hide()):(console.warn("data error"),lego.search_error())},error:function(e,a){lego.search_error();var t=e+", "+a;console.log("Request Failed: "+t)}})},lego.search_error=function(){$('<div class="b-wlist__error">Nothing was found. <a class="b-wlist__error__link" href="/">Geolocation?</a></div>').appendTo(".b-wlist"),$(".b-wlist__error__link").click(function(){lego.geoLocation()}),$(".b-loader").hide()},lego.windParse=function(e,a){return e>=350&&10>e?"Wind north "+a+"m/s":e>=10&&20>e?"Wind north northeast "+a+"m/s":e>=20&&70>e?"Wind northeast "+a+"m/s":e>=70&&80>e?"Wind east northeast "+a+"m/s":e>=80&&100>e?"Wind east "+a+"m/s":e>=110&&160>e?"Wind east southeast "+a+"m/s":e>=160&&170>e?"Wind southeast "+a+"m/s":e>=170&&190>e?"Wind south "+a+"m/s":e>=190&&200>e?"Wind south southwest "+a+"m/s":e>=200&&250>e?"Wind southwest "+a+"m/s":e>=250&&260>e?"Wind west southwest "+a+"m/s":e>=260&&280>e?"Wind west "+a+"m/s":e>=280&&290>e?"Wind northwest west "+a+"m/s":e>=290&&340>e?"Wind northwest "+a+"m/s":e>=340&&350>e?"Wind north northwest "+a+"m/s":""},lego.weather_city=function(){var e,a,t,o=window.location.pathname.split("/"),r=o[2];$.ajax({type:"GET",url:"/api/weather/city/"+r,dataType:"json",success:function(t){if(200==t.cod){var o='<span class="b-weather__locname_city">{city}</span><span class="b-weather__locname_country">{country}</span>';e=o.replace("{city}",t.name).replace("{country}",t.sys.country);var r='<div class="b-weather-now__data"><div class="b-weather-now__data__main"><span class="b-weather-now__data__main_temp">{temp}℃</span><span class="b-weather-now__data__main_sky"><span class="b-weather-now__data__main_sky_descr">{sky}</span><span class="b-weather-now__data__main_sky_fdescr"> {sky-text}</span></span></div><div class="b-weather-now__data__wind b-weather-now__data_sec"><span class="b-weather-now__data__wind_val">{wind}</span></div><div class="b-weather-now__data__pres b-weather-now__data_sec"><span class="b-weather-now__data__pres_val">Pressure {pressure} hPa</span></div><div class="b-weather-now__data__hum b-weather-now__data_sec"><span class="b-weather-now__data__hum_val">Humidity {humidity}%</span></div></div>';a=r.replace("{temp}",t.main.temp.toFixed(1)).replace("{sky}",t.weather[0].main).replace("{sky-text}",t.weather[0].description).replace("{wind}",lego.windParse(t.wind.deg,t.wind.speed)).replace("{pressure}",t.main.pressure).replace("{humidity}",t.main.humidity),$(a).appendTo(".b-weather-now"),$(e).appendTo(".b-weather__locname"),lego.mapLoad(t.coord.lat,t.coord.lon,"b-map")}else lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:t.message})},error:function(e,a,t){var o=a+", "+t;console.log("Request Failed: "+o),lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorCode:"02"})}}),$.ajax({type:"GET",url:"/api/forecast/city/"+r,dataType:"json",success:function(e){200==e.cod?$.each(e.list,function(e,a){var o=new Date(1e3*a.dt),r={day:o.getDate(),month:o.getMonth()+1};switch(r.month){case 1:r.monthtxt="January";break;case 2:r.monthtxt="February";break;case 3:r.monthtxt="March";break;case 4:r.monthtxt="April";break;case 5:r.monthtxt="May";break;case 6:r.monthtxt="June";break;case 7:r.monthtxt="July";break;case 8:r.monthtxt="August";break;case 9:r.monthtxt="September";break;case 10:r.monthtxt="October";break;case 11:r.monthtxt="November";break;case 12:r.monthtxt="December";break;default:r.monthtxt="<!-- Error -->"}var n='<div class="b-weather-forecast__line"><div class="b-weather-forecast__section b-weather-forecast__section_date">{date}</div><div class="b-weather-forecast__section b-weather-forecast__section_content"><span class="b-weather-forecast__section__item b-weather-forecast__main">{main}</span><span class="b-weather-forecast__section__item b-weather-forecast__temp"><span class="b-weather-forecast__temp_max">↑{temp-max}</span> <span class="b-weather-forecast__temp_min">↓{temp-min}</span></span><span class="b-weather-forecast__section__item b-weather-forecast__wind">{wind}</span></div></div>';t=n.replace("{date}",'<span class="b-weather-forecast__section__item b-weather-forecast__section__day">'+r.day+"</span>").replace("{temp-max}",a.temp.max.toFixed(1)+"℃").replace("{temp-min}",a.temp.min.toFixed(1)+"℃").replace("{main}",a.weather[0].main).replace("{wind}",lego.windParse(a.deg,a.speed)),$(t).appendTo(".b-weather-forecast")}):lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:e.message})},error:function(e,a,t){var o=a+", "+t;console.log("Request #2 Failed: "+o),lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:data.message})}}),$(".b-loader").hide(),lego.weather_select()},lego.weather_location=function(){function e(){"true"!=a.error?($.ajax({type:"GET",url:"/api/weather/coords/"+a.lat+"/"+a.lon,dataType:"json",success:function(e){if(200==e.cod){var t='<span class="b-weather__locname_city">{city}</span><span class="b-weather__locname_country">{country}</span>',o=t.replace("{city}",e.name).replace("{country}",e.sys.country),r='<div class="b-weather-now__data"><div class="b-weather-now__data__main"><span class="b-weather-now__data__main_temp">{temp}℃</span><span class="b-weather-now__data__main_sky"><span class="b-weather-now__data__main_sky_descr">{sky}</span><span class="b-weather-now__data__main_sky_fdescr"> {sky-text}</span></span></div><div class="b-weather-now__data__wind b-weather-now__data_sec"><span class="b-weather-now__data__wind_val">{wind}</span></div><div class="b-weather-now__data__pres b-weather-now__data_sec"><span class="b-weather-now__data__pres_val">Pressure {pressure} hPa</span></div><div class="b-weather-now__data__hum b-weather-now__data_sec"><span class="b-weather-now__data__hum_val">Humidity {humidity}%</span></div></div>',n=r.replace("{temp}",e.main.temp.toFixed(1)).replace("{sky}",e.weather[0].main).replace("{sky-text}",e.weather[0].description).replace("{wind}",lego.windParse(e.wind.deg,e.wind.speed)).replace("{pressure}",e.main.pressure).replace("{humidity}",e.main.humidity);$(".b-loader").hide(),$(o).appendTo(".b-weather__locname"),$(n).appendTo(".b-weather-now"),lego.mapLoad(a.lat,a.lon,"b-map")}else lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:e.message})},error:function(e,a,t){var o=a+", "+t;console.log("Request Failed: "+o)}}),$.ajax({type:"GET",url:"/api/forecast/coords/"+a.lat+"/"+a.lon,dataType:"json",success:function(e){200==e.cod?$.each(e.list,function(e,a){var t=new Date(1e3*a.dt),o={day:t.getDate(),month:t.getMonth()+1,monthtxt:""};switch(o.month){case 1:o.monthtxt="January";break;case 2:o.monthtxt="February";break;case 3:o.monthtxt="March";break;case 4:o.monthtxt="April";break;case 5:o.monthtxt="May";break;case 6:o.monthtxt="June";break;case 7:o.monthtxt="July";break;case 8:o.monthtxt="August";break;case 9:o.monthtxt="September";break;case 10:o.monthtxt="October";break;case 11:o.monthtxt="November";break;case 12:o.monthtxt="December";break;default:o.monthtxt="<!-- Error -->"}var r='<div class="b-weather-forecast__line"><div class="b-weather-forecast__section b-weather-forecast__section_date">{date}</div><div class="b-weather-forecast__section b-weather-forecast__section_content"><span class="b-weather-forecast__section__item b-weather-forecast__main">{main}</span><span class="b-weather-forecast__section__item b-weather-forecast__temp"><span class="b-weather-forecast__temp_max">↑{temp-max}</span> <span class="b-weather-forecast__temp_min">↓{temp-min}</span></span><span class="b-weather-forecast__section__item b-weather-forecast__wind">{wind}</span></div></div>',n=r.replace("{date}",'<span class="b-weather-forecast__section__item b-weather-forecast__section__day">'+o.day+"</span>").replace("{temp-max}",a.temp.max.toFixed(1)+"℃").replace("{temp-min}",a.temp.min.toFixed(1)+"℃").replace("{main}",a.weather[0].main).replace("{wind}",lego.windParse(a.deg,a.speed));$(n).appendTo(".b-weather-forecast")}):lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:e.message})},error:function(e,a,t){var o=a+", "+t;console.log("Request #2 Failed: "+o),lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorCode:"02"})}})):lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorCode:"01"})}var a={lat:lego.getCookie("latitude"),lon:lego.getCookie("longitude"),error:lego.getCookie("geoLocationError")};void 0===a.lat||void 0===a.lon?lego.geoLocation(function(a){lego.setCookie("latitude",a.coords.longitude).setCookie("longitude",a.coords.longitude),e()}):e(),lego.weather_select()},lego.error=function(e){void 0!==e.before&&e.before(),void 0===e.errorText&&("01"==e.errorCode?e.errorText="Geolocation error":"02"==e.errorCode&&(e.errorText="Data error")),$(".b-error").append('<p class="b-error__descr">'+e.errorText+"</p>"),$(".b-error").show(),void 0!==e.after&&e.after()},lego.weather_select=function(){"#forecast"==window.location.hash&&($(".b-weather-select__item_forecast").addClass("b-weather-select__item_active"),$(".b-weather-select__item_now").removeClass("b-weather-select__item_active"),$(".b-weather-forecast").addClass("b-weather_active"),$(".b-weather-now").removeClass("b-weather_active"),$(".b-footer").addClass("b-footer_st")),$(".b-weather-select__item_now").click(function(){$(this).addClass("b-weather-select__item_active"),$(".b-weather-select__item_forecast").removeClass("b-weather-select__item_active"),$(".b-weather-now").addClass("b-weather_active"),$(".b-weather-forecast").removeClass("b-weather_active"),$(".b-footer").removeClass("b-footer_st")}),$(".b-weather-select__item_forecast").click(function(){$(this).addClass("b-weather-select__item_active"),$(".b-weather-select__item_now").removeClass("b-weather-select__item_active"),$(".b-weather-forecast").addClass("b-weather_active"),$(".b-weather-now").removeClass("b-weather_active"),$(".b-footer").addClass("b-footer_st")})};