!function(e){e.getScript=function(e,t){var r=document.createElement("script");r.async="async",r.src=e,t&&(r.onload=t),document.getElementsByTagName("head")[0].appendChild(r)}}($);var lego={};lego.setCookie=function(e,t){var r=new Date((new Date).getTime()+6e6),a=t+"; expires="+r.toUTCString();document.cookie=e+"="+a},lego.getCookie=function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},lego.getURLParameter=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},lego.geoLocation=function(e,t){Modernizr.geolocation?navigator.geolocation.getCurrentPosition(function(t){lego.setCookie("latitude",t.coords.latitude),lego.setCookie("longitude",t.coords.longitude),console.info("Location successfully determined."),lego.setCookie("geoLocationError","false"),e()},function(){console.warn("During detection location the error occurred."),lego.setCookie("geoLocationError","true"),t()}):(console.warn("During detection location the error occurred."),lego.setCookie("geoLocationError","true"),t())},lego.md5=function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,a,o,n,s;return o=2147483648&e,n=2147483648&t,r=1073741824&e,a=1073741824&t,s=(1073741823&e)+(1073741823&t),r&a?2147483648^s^o^n:r|a?1073741824&s?3221225472^s^o^n:1073741824^s^o^n:s^o^n}function a(e,t,r){return e&t|~e&r}function o(e,t,r){return e&r|t&~r}function n(e,t,r){return e^t^r}function s(e,t,r){return t^(e|~r)}function i(e,o,n,s,i,c,l){return e=r(e,r(r(a(o,n,s),i),l)),r(t(e,c),o)}function c(e,a,n,s,i,c,l){return e=r(e,r(r(o(a,n,s),i),l)),r(t(e,c),a)}function l(e,a,o,s,i,c,l){return e=r(e,r(r(n(a,o,s),i),l)),r(t(e,c),a)}function d(e,a,o,n,i,c,l){return e=r(e,r(r(s(a,o,n),i),l)),r(t(e,c),a)}function _(e){for(var t,r=e.length,a=r+8,o=(a-a%64)/64,n=16*(o+1),s=Array(n-1),i=0,c=0;r>c;)t=(c-c%4)/4,i=c%4*8,s[t]=s[t]|e.charCodeAt(c)<<i,c++;return t=(c-c%4)/4,i=c%4*8,s[t]=s[t]|128<<i,s[n-2]=r<<3,s[n-1]=r>>>29,s}function h(e){var t,r,a="",o="";for(r=0;3>=r;r++)t=e>>>8*r&255,o="0"+t.toString(16),a+=o.substr(o.length-2,2);return a}function p(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var a=e.charCodeAt(r);128>a?t+=String.fromCharCode(a):a>127&&2048>a?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t}var u,m,w,b,f,g,y,v,I,x=Array(),k=7,N=12,C=17,$=22,T=5,S=9,j=14,E=20,M=4,P=11,R=16,L=23,A=6,D=10,H=15,W=21;for(e=p(e),x=_(e),g=1732584193,y=4023233417,v=2562383102,I=271733878,u=0;u<x.length;u+=16)m=g,w=y,b=v,f=I,g=i(g,y,v,I,x[u+0],k,3614090360),I=i(I,g,y,v,x[u+1],N,3905402710),v=i(v,I,g,y,x[u+2],C,606105819),y=i(y,v,I,g,x[u+3],$,3250441966),g=i(g,y,v,I,x[u+4],k,4118548399),I=i(I,g,y,v,x[u+5],N,1200080426),v=i(v,I,g,y,x[u+6],C,2821735955),y=i(y,v,I,g,x[u+7],$,4249261313),g=i(g,y,v,I,x[u+8],k,1770035416),I=i(I,g,y,v,x[u+9],N,2336552879),v=i(v,I,g,y,x[u+10],C,4294925233),y=i(y,v,I,g,x[u+11],$,2304563134),g=i(g,y,v,I,x[u+12],k,1804603682),I=i(I,g,y,v,x[u+13],N,4254626195),v=i(v,I,g,y,x[u+14],C,2792965006),y=i(y,v,I,g,x[u+15],$,1236535329),g=c(g,y,v,I,x[u+1],T,4129170786),I=c(I,g,y,v,x[u+6],S,3225465664),v=c(v,I,g,y,x[u+11],j,643717713),y=c(y,v,I,g,x[u+0],E,3921069994),g=c(g,y,v,I,x[u+5],T,3593408605),I=c(I,g,y,v,x[u+10],S,38016083),v=c(v,I,g,y,x[u+15],j,3634488961),y=c(y,v,I,g,x[u+4],E,3889429448),g=c(g,y,v,I,x[u+9],T,568446438),I=c(I,g,y,v,x[u+14],S,3275163606),v=c(v,I,g,y,x[u+3],j,4107603335),y=c(y,v,I,g,x[u+8],E,1163531501),g=c(g,y,v,I,x[u+13],T,2850285829),I=c(I,g,y,v,x[u+2],S,4243563512),v=c(v,I,g,y,x[u+7],j,1735328473),y=c(y,v,I,g,x[u+12],E,2368359562),g=l(g,y,v,I,x[u+5],M,4294588738),I=l(I,g,y,v,x[u+8],P,2272392833),v=l(v,I,g,y,x[u+11],R,1839030562),y=l(y,v,I,g,x[u+14],L,4259657740),g=l(g,y,v,I,x[u+1],M,2763975236),I=l(I,g,y,v,x[u+4],P,1272893353),v=l(v,I,g,y,x[u+7],R,4139469664),y=l(y,v,I,g,x[u+10],L,3200236656),g=l(g,y,v,I,x[u+13],M,681279174),I=l(I,g,y,v,x[u+0],P,3936430074),v=l(v,I,g,y,x[u+3],R,3572445317),y=l(y,v,I,g,x[u+6],L,76029189),g=l(g,y,v,I,x[u+9],M,3654602809),I=l(I,g,y,v,x[u+12],P,3873151461),v=l(v,I,g,y,x[u+15],R,530742520),y=l(y,v,I,g,x[u+2],L,3299628645),g=d(g,y,v,I,x[u+0],A,4096336452),I=d(I,g,y,v,x[u+7],D,1126891415),v=d(v,I,g,y,x[u+14],H,2878612391),y=d(y,v,I,g,x[u+5],W,4237533241),g=d(g,y,v,I,x[u+12],A,1700485571),I=d(I,g,y,v,x[u+3],D,2399980690),v=d(v,I,g,y,x[u+10],H,4293915773),y=d(y,v,I,g,x[u+1],W,2240044497),g=d(g,y,v,I,x[u+8],A,1873313359),I=d(I,g,y,v,x[u+15],D,4264355552),v=d(v,I,g,y,x[u+6],H,2734768916),y=d(y,v,I,g,x[u+13],W,1309151649),g=d(g,y,v,I,x[u+4],A,4149444226),I=d(I,g,y,v,x[u+11],D,3174756917),v=d(v,I,g,y,x[u+2],H,718787259),y=d(y,v,I,g,x[u+9],W,3951481745),g=r(g,m),y=r(y,w),v=r(v,b),I=r(I,f);var U=h(g)+h(y)+h(v)+h(I);return U.toLowerCase()},lego.checkAuth=function(e,t){var r=lego.getCookie("sid");null===r||void 0===r?e():$.ajax({type:"GET",url:"/api/v1/user/me?sid="+r,dataType:"json",success:function(r){"invalid session"===r.error?e():t(r)},error:function(t,r){e(),console.error(t,r)}})},lego.userInfo_init=function(){$(".b-user").html('<div class="b-user__item b-user__avatar b-user__avatar_small"><img class="b-user__avatar__img" src="http://www.gravatar.com/avatar/'+localStorage.getItem("emailHash")+'?s=30&d=mm"/></div><div class="b-user__item b-user__name">'+localStorage.getItem("displayname")+'</div><div class="b-user__item b-user__profile b-user__profile_header"><a class="b-link b-user__profile__link" href="/profile">Profile</a></div><div class="b-user__item b-user__logout"><a class="b-link b-user__logout__link" href="/logout">Logout</a></div>')},lego.mapLoad=function(e,t,r){google.maps.event.addDomListener(window,"load",lego.mapInit(e,t,r))},lego.mapInit=function(e,t,r){var a={zoom:13,center:new google.maps.LatLng(e,t),disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.TERRAIN};lego.mapInitParams=new google.maps.Map(document.getElementById(r),a)},lego.chcontainer_init=function(){$(".b-chcontainer__item_loc").click(function(){return $(".b-chcontainer__item__img_geoloc").attr("src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTAiIGhlaWdodD0iMTEwIj48Y2lyY2xlIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI1NS4xMzgiIGN5PSI1Ni4xMTciIHI9IjQxLjMwNCIgZmlsbD0ibm9uZSIvPjxsaW5lIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSIxOC44NzUiIHkxPSI1Ni4xMzUiIHgyPSI0Ljg3NSIgeTI9IjU2LjEzNSIgZmlsbD0ibm9uZSIvPjxsaW5lIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSI5MS44NzUiIHkxPSI1Ni4xMzUiIHgyPSIxMDQuODc1IiB5Mj0iNTYuMTM1IiBmaWxsPSJub25lIi8+PGxpbmUgc3Ryb2tlPSIjNEQ0RDREIiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjU0Ljg3NSIgeTE9IjE5LjEzNSIgeDI9IjU0Ljg3NSIgeTI9IjYuMTM1IiBmaWxsPSJub25lIi8+PGxpbmUgc3Ryb2tlPSIjNEQ0RDREIiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjU0Ljg3NSIgeTE9IjkzLjEzNSIgeDI9IjU0Ljg3NSIgeTI9IjEwNi4xMzUiIGZpbGw9Im5vbmUiLz48Y2lyY2xlIGZpbGw9IiNmMDAiIHN0cm9rZT0iI2YwMCIgc3Ryb2tlLXdpZHRoPSIuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgY3g9IjU1LjEzOCIgY3k9IjU2LjExNyIgcj0iMTcuMzkxIi8+PC9zdmc+"),void 0===lego.getCookie("latitude")||void 0===lego.getCookie("longitude")?lego.geoLocation(function(){document.location.href="/location"},function(){document.location.href="/location"}):(lego.setCookie("geoLocationError","false"),document.location.href="/location"),!1}),$(".b-chcontainer__item_search").click(function(){return $(".b-chcontainer__item_search").addClass("b-chcontainer__item_invis"),$(".b-chcontainer__item__form").addClass("b-chcontainer__item_vis"),!1})},lego.search_init=function(){var e=lego.getURLParameter("q");$(".b-search__q").text(e),document.searchf.q.value=e,$.ajax({type:"GET",url:"/api/search/"+e,dataType:"json",success:function(e){200==e.cod?($(".b-weather__locname_city").text(e.name),0===e.count?lego.search_error():1===e.count&&(document.location.href="/city/"+e.list[0].id),$.each(e.list,function(e,t){var r='<div class="b-wlist__line"><div class="b-wlist__line__head"><a class="b-wlist__link" href="/city/{itemid}">{itemname}<a/> <span class"b-wlist__country">{itemcountry}</span></div><div class="b-wlist__line__content"><span class="b-wlist__temp">{itemtemp}℃</span> <span class="b-wlist__sky">{itemweather}</span></div></div>',a=r.replace("{itemid}",t.id).replace("{itemname}",t.name).replace("{itemcountry}",t.sys.country).replace("{itemtemp}",t.main.temp.toFixed(1)).replace("{itemweather}",t.weather[0].main);$(a).appendTo(".b-wlist")}),$(".b-loader").hide()):(console.warn("data error"),lego.search_error())},error:function(e,t){lego.search_error();var r=e+", "+t;console.log("Request Failed: "+r)}})},lego.search_error=function(){$('<div class="b-wlist__error">Nothing was found. <a class="b-wlist__error__link" href="/">Geolocation?</a></div>').appendTo(".b-wlist"),$(".b-wlist__error__link").click(function(){lego.geoLocation()}),$(".b-loader").hide()},lego.windParse=function(e,t){return e>=350&&10>e?"Wind north "+t+"m/s":e>=10&&20>e?"Wind north northeast "+t+"m/s":e>=20&&70>e?"Wind northeast "+t+"m/s":e>=70&&80>e?"Wind east northeast "+t+"m/s":e>=80&&100>e?"Wind east "+t+"m/s":e>=110&&160>e?"Wind east southeast "+t+"m/s":e>=160&&170>e?"Wind southeast "+t+"m/s":e>=170&&190>e?"Wind south "+t+"m/s":e>=190&&200>e?"Wind south southwest "+t+"m/s":e>=200&&250>e?"Wind southwest "+t+"m/s":e>=250&&260>e?"Wind west southwest "+t+"m/s":e>=260&&280>e?"Wind west "+t+"m/s":e>=280&&290>e?"Wind northwest west "+t+"m/s":e>=290&&340>e?"Wind northwest "+t+"m/s":e>=340&&350>e?"Wind north northwest "+t+"m/s":""},lego.weather_city=function(){var e,t,r,a=window.location.pathname.split("/"),o=a[2];$.ajax({type:"GET",url:"/api/weather/city/"+o,dataType:"json",success:function(r){if(200==r.cod){var a='<span class="b-weather__locname_city">{city}</span><span class="b-weather__locname_country">{country}</span>';e=a.replace("{city}",r.name).replace("{country}",r.sys.country);var o='<div class="b-weather-now__data"><div class="b-weather-now__data__main"><span class="b-weather-now__data__main_temp">{temp}℃</span><span class="b-weather-now__data__main_sky"><span class="b-weather-now__data__main_sky_descr">{sky}</span><span class="b-weather-now__data__main_sky_fdescr"> {sky-text}</span></span></div><div class="b-weather-now__data__wind b-weather-now__data_sec"><span class="b-weather-now__data__wind_val">{wind}</span></div><div class="b-weather-now__data__pres b-weather-now__data_sec"><span class="b-weather-now__data__pres_val">Pressure {pressure} hPa</span></div><div class="b-weather-now__data__hum b-weather-now__data_sec"><span class="b-weather-now__data__hum_val">Humidity {humidity}%</span></div></div>';t=o.replace("{temp}",r.main.temp.toFixed(1)).replace("{sky}",r.weather[0].main).replace("{sky-text}",r.weather[0].description).replace("{wind}",lego.windParse(r.wind.deg,r.wind.speed)).replace("{pressure}",r.main.pressure).replace("{humidity}",r.main.humidity),$(t).appendTo(".b-weather-now"),$(e).appendTo(".b-weather__locname"),lego.mapLoad(r.coord.lat,r.coord.lon,"b-map")}else lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:r.message})},error:function(e,t,r){var a=t+", "+r;console.log("Request Failed: "+a),lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorCode:"02"})}}),$.ajax({type:"GET",url:"/api/forecast/city/"+o,dataType:"json",success:function(e){200==e.cod?$.each(e.list,function(e,t){var a=new Date(1e3*t.dt),o={day:a.getDate(),month:a.getMonth()+1};switch(o.month){case 1:o.monthtxt="January";break;case 2:o.monthtxt="February";break;case 3:o.monthtxt="March";break;case 4:o.monthtxt="April";break;case 5:o.monthtxt="May";break;case 6:o.monthtxt="June";break;case 7:o.monthtxt="July";break;case 8:o.monthtxt="August";break;case 9:o.monthtxt="September";break;case 10:o.monthtxt="October";break;case 11:o.monthtxt="November";break;case 12:o.monthtxt="December";break;default:o.monthtxt="<!-- Error -->"}var n='<div class="b-weather-forecast__line"><div class="b-weather-forecast__section b-weather-forecast__section_date">{date}</div><div class="b-weather-forecast__section b-weather-forecast__section_content"><span class="b-weather-forecast__section__item b-weather-forecast__main">{main}</span><span class="b-weather-forecast__section__item b-weather-forecast__temp"><span class="b-weather-forecast__temp_max">↑{temp-max}</span> <span class="b-weather-forecast__temp_min">↓{temp-min}</span></span><span class="b-weather-forecast__section__item b-weather-forecast__wind">{wind}</span></div></div>';r=n.replace("{date}",'<span class="b-weather-forecast__section__item b-weather-forecast__section__day">'+o.day+"</span>").replace("{temp-max}",t.temp.max.toFixed(1)+"℃").replace("{temp-min}",t.temp.min.toFixed(1)+"℃").replace("{main}",t.weather[0].main).replace("{wind}",lego.windParse(t.deg,t.speed)),$(r).appendTo(".b-weather-forecast")}):lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:e.message})},error:function(e,t,r){var a=t+", "+r;console.log("Request #2 Failed: "+a),lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:data.message})}}),$(".b-loader").hide(),lego.weather_select()},lego.weather_location=function(){function e(){"true"!=t.error?($.ajax({type:"GET",url:"/api/weather/coords/"+t.lat+"/"+t.lon,dataType:"json",success:function(e){if(200==e.cod){var r='<span class="b-weather__locname_city">{city}</span><span class="b-weather__locname_country">{country}</span>',a=r.replace("{city}",e.name).replace("{country}",e.sys.country),o='<div class="b-weather-now__data"><div class="b-weather-now__data__main"><span class="b-weather-now__data__main_temp">{temp}℃</span><span class="b-weather-now__data__main_sky"><span class="b-weather-now__data__main_sky_descr">{sky}</span><span class="b-weather-now__data__main_sky_fdescr"> {sky-text}</span></span></div><div class="b-weather-now__data__wind b-weather-now__data_sec"><span class="b-weather-now__data__wind_val">{wind}</span></div><div class="b-weather-now__data__pres b-weather-now__data_sec"><span class="b-weather-now__data__pres_val">Pressure {pressure} hPa</span></div><div class="b-weather-now__data__hum b-weather-now__data_sec"><span class="b-weather-now__data__hum_val">Humidity {humidity}%</span></div></div>',n=o.replace("{temp}",e.main.temp.toFixed(1)).replace("{sky}",e.weather[0].main).replace("{sky-text}",e.weather[0].description).replace("{wind}",lego.windParse(e.wind.deg,e.wind.speed)).replace("{pressure}",e.main.pressure).replace("{humidity}",e.main.humidity);$(".b-loader").hide(),$(a).appendTo(".b-weather__locname"),$(n).appendTo(".b-weather-now"),lego.mapLoad(t.lat,t.lon,"b-map")}else lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:e.message})},error:function(e,t,r){var a=t+", "+r;console.log("Request Failed: "+a)}}),$.ajax({type:"GET",url:"/api/forecast/coords/"+t.lat+"/"+t.lon,dataType:"json",success:function(e){200==e.cod?$.each(e.list,function(e,t){var r=new Date(1e3*t.dt),a={day:r.getDate(),month:r.getMonth()+1,monthtxt:""};switch(a.month){case 1:a.monthtxt="January";break;case 2:a.monthtxt="February";break;case 3:a.monthtxt="March";break;case 4:a.monthtxt="April";break;case 5:a.monthtxt="May";break;case 6:a.monthtxt="June";break;case 7:a.monthtxt="July";break;case 8:a.monthtxt="August";break;case 9:a.monthtxt="September";break;case 10:a.monthtxt="October";break;case 11:a.monthtxt="November";break;case 12:a.monthtxt="December";break;default:a.monthtxt="<!-- Error -->"}var o='<div class="b-weather-forecast__line"><div class="b-weather-forecast__section b-weather-forecast__section_date">{date}</div><div class="b-weather-forecast__section b-weather-forecast__section_content"><span class="b-weather-forecast__section__item b-weather-forecast__main">{main}</span><span class="b-weather-forecast__section__item b-weather-forecast__temp"><span class="b-weather-forecast__temp_max">↑{temp-max}</span> <span class="b-weather-forecast__temp_min">↓{temp-min}</span></span><span class="b-weather-forecast__section__item b-weather-forecast__wind">{wind}</span></div></div>',n=o.replace("{date}",'<span class="b-weather-forecast__section__item b-weather-forecast__section__day">'+a.day+"</span>").replace("{temp-max}",t.temp.max.toFixed(1)+"℃").replace("{temp-min}",t.temp.min.toFixed(1)+"℃").replace("{main}",t.weather[0].main).replace("{wind}",lego.windParse(t.deg,t.speed));$(n).appendTo(".b-weather-forecast")}):lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorText:e.message})},error:function(e,t,r){var a=t+", "+r;console.log("Request #2 Failed: "+a),lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorCode:"02"})}})):lego.error({before:function(){$(".b-container-weather_weather").hide(),$(".b-loader").hide()},errorCode:"01"})}var t={lat:lego.getCookie("latitude"),lon:lego.getCookie("longitude"),error:lego.getCookie("geoLocationError")};void 0===t.lat||void 0===t.lon?lego.geoLocation(function(t){lego.setCookie("latitude",t.coords.longitude).setCookie("longitude",t.coords.longitude),e()}):e(),lego.weather_select()},lego.error=function(e){void 0!==e.before&&e.before(),void 0===e.errorText&&("01"==e.errorCode?e.errorText="Geolocation error":"02"==e.errorCode&&(e.errorText="Data error")),$(".b-error").append('<p class="b-error__descr">'+e.errorText+"</p>"),$(".b-error").show(),void 0!==e.after&&e.after()},lego.weather_select=function(){"#forecast"==window.location.hash&&($(".b-weather-select__item_forecast").addClass("b-weather-select__item_active"),$(".b-weather-select__item_now").removeClass("b-weather-select__item_active"),$(".b-weather-forecast").addClass("b-weather_active"),$(".b-weather-now").removeClass("b-weather_active"),$(".b-footer").addClass("b-footer_st")),$(".b-weather-select__item_now").click(function(){$(this).addClass("b-weather-select__item_active"),$(".b-weather-select__item_forecast").removeClass("b-weather-select__item_active"),$(".b-weather-now").addClass("b-weather_active"),$(".b-weather-forecast").removeClass("b-weather_active"),$(".b-footer").removeClass("b-footer_st")}),$(".b-weather-select__item_forecast").click(function(){$(this).addClass("b-weather-select__item_active"),$(".b-weather-select__item_now").removeClass("b-weather-select__item_active"),$(".b-weather-forecast").addClass("b-weather_active"),$(".b-weather-now").removeClass("b-weather_active"),$(".b-footer").addClass("b-footer_st")})};var yr={};!function(){function e(e){return e.replace(/&/g,"&amp;")}function t(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function r(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}yr.Module=function(){},yr.Module.prototype.doc=function(e){return new yr.Doc(e,this)},yr.Module.prototype.applyValue=function(e,t,r,a){var o="",n=t.length;if(!n)return o;var s,i=arguments.length;i>6&&(s=Array.prototype.slice.call(arguments,6));for(var c=e.imports,l=0;n>l;l++){for(var d,_=t[l],h=!1,p=0,u=c.length;!h&&u>p;){d=c[p++];var m=d.matcher[r];if(m){var w=m[_.name]||m["*"];if(w)for(var b=0,f=w.length;!h&&f>b;){var g=w[b++],y=d[g],v=y.j;if(v)d.matched(v,y.a,_,l,n)&&(h=g);else for(var I=y.s,x=y.a,k=0,N=I.length;N>k;k++)if(d.matched(I[k],x[k],_,l,n)){h=g;break}}}}if(h)switch(i){case 4:o+=y(e,_,l,n,a);break;case 5:o+=y(e,_,l,n,a,arguments[4]);break;case 6:o+=y(e,_,l,n,a,arguments[4],arguments[5]);break;default:o+=y.apply(e,[e,_,l,n,a].concat(s))}}return o},yr.Doc=function(e){this.root=new yr.Node(e,"",this),this._keys={},this._vars={}},yr.Node=function(e,t,r,a){this.data=e,this.name=t,this.doc=r,this.parent=a||null},yr.Node.prototype.child=function(e,t){return new yr.Node(e,t,this.doc,this)},yr.Node.prototype.step=function(e,t){t=t||new yr.Nodeset;var r=this.data;if(!r||"object"!=typeof r)return t;if(r=r[e],void 0===r)return t;if(r instanceof Array)for(var a=0,o=r.length;o>a;a++)t.push(this.child(r[a],e));else t.push(this.child(r,e));return t},yr.Node.prototype.star=function(e){e=e||new yr.Nodeset;var t=this.data;for(var r in t)this.step(r,e);return e},yr.Node.prototype.dots=function(e,t){for(var r=this,a=0;r&&e>a;)r=r.parent,a++;return r&&t.push(r),t},yr.Node.prototype.scalar=function(){var e=this.data;return"object"==typeof e?"":e},yr.Node.prototype.boolean=function(){return!!this.data},yr.Node.prototype.xml=function(){},yr.Node.prototype.isEmpty=function(){return!1},yr.Node.prototype.select=function(e){for(var t=this,r=0,a=e.length;a>r;r+=2){var o=e[r],n=e[r+1];switch(o){case 1:t=t.step(n);break;case 2:t=t.star();break;case 3:t=t.index(n);break;case 4:t=t.dots(n);break;case 5:t=t.filter(n);break;case 7:t=t.guard(n)}if(t.isEmpty())return t}return t},yr.Node.prototype.matches=function(e,t){if(1===e)return!this.parent;for(var r=e.length,a=r-2;a>=0;){if(!c0)return!1;var o=e[a];switch(o){case 0:var n=e[a+1];if("*"!==n&&n!==c0.name)return!1;c0=c0.parent;break;case 2:case 4:var s=e[a+1];if(!s(this,c0,i0,l0))return!1}a-=2}return t&&c0.parent?!1:!0},yr.scalarStep=function(){},yr.booleanStep=function(){},yr.xmlStep=function(){},yr.Nodeset=function(e){this.nodes=e||[]},yr.Nodeset.prototype.isEmpty=function(){return 0===this.nodes.length},yr.Nodeset.prototype.push=function(e){this.nodes.push(e)},yr.Nodeset.prototype.step=function(e,t){t=t||new yr.Nodeset;for(var r=this.nodes,a=0,o=r.length;o>a;a++)r[a].step(e,t);return t},yr.Nodeset.prototype.star=function(e){e=e||new yr.Nodeset;for(var t=this.nodes,r=0,a=t.length;a>r;r++)t[r].star(e);return e},yr.Nodeset.prototype.dots=function(e,t){t=t||new yr.Nodeset;for(var r=this.nodes,a=0,o=r.length;o>a;a++)r[a].dots(e,t);return t},yr.Nodeset.prototype.index=function(e){var t=this.nodes[e],r=new yr.Nodeset;return t&&r.push(t),r},yr.Nodeset.prototype.filter=function(e){for(var t=new yr.Nodeset,r=this.nodes,a=0,o=r.length;o>a;a++){var n=r[a];e(n,a,o)&&t.push(n)}return t},yr.Nodeset.prototype.guard=function(e){var t=this.nodes;return t.length>0&&e(t[0].doc.root)?this:new yr.Nodeset},yr.Nodeset.prototype.scalar=function(){return this.isEmpty()?"":this.nodes[0].scalar()},yr.Nodeset.prototype.boolean=function(){return!this.isEmpty()&&this.nodes[0].boolean()},yr.Nodeset.prototype.toArray=function(){for(var e=[],t=this.nodes,r=0,a=t.length;a>r;r++)e.push(t[r].data);return e},yr.Nodeset.prototype.concat=function(e){return new yr.Nodeset(this.nodes.concat(e.nodes))},yr.Nodeset.prototype.name=function(){return this.isEmpty()?"":this.nodes[0].name},yr.Nodeset.prototype.select=function(e){for(var t=new yr.Nodeset,r=this.nodes,a=0,o=r.length;o>a;a++)t=t.concat(r[a].select(e));return t},yr.Attrs=function(){this.attrs={},this.name=""},yr.Attrs.prototype.add=function(e,t){this.attrs[e]=t};var a=yr.shortTags={br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,wbr:!0};yr.Attrs.prototype.close=function(){var e=this.name,t="";if(e){var r=this.attrs;for(var o in r)t+=" "+o+'="'+r[o].quote()+'"';t+=a[e]?"/>":">",this.name=""}return t},yr.Attrs.prototype.copy=function(e){e=e||new yr.Attrs;this.attrs,e.attrs;for(var t in attrs)e[t]=from[t];return e.name=this.name,e},yr.scalarAttr=function(e){this.s=null==e?"":e.toString()},yr.scalarAttr.prototype.quote=function(){return t(this.s)},yr.scalarAttr.prototype.add_xml=function(t){return new yr.xmlAttr(e(this.s)+t)},yr.scalarAttr.prototype.add_scalar=function(e){return new yr.scalarAttr(this.s+e)},yr.xmlAttr=function(e){this.s=null==e?"":e.toString()},yr.xmlAttr.prototype.quote=function(){return r(this.s)},yr.xmlAttr.prototype.addscalar=function(t){return new yr.xmlAttr(this.s+e(t))}}();