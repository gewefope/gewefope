/* 2014-01-05 (c) World Fly */ 
var lego={};lego.setCookie=function(a,b){var c=new Date((new Date).getTime()+6e6),d=b+"; expires="+c.toUTCString();document.cookie=a+"="+d},lego.getCookie=function(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return b?decodeURIComponent(b[1]):void 0},lego.getURLParameter=function(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},lego.geoLocation=function(a,b){Modernizr.geolocation?navigator.geolocation.getCurrentPosition(function(b){lego.setCookie("latitude",b.coords.latitude),lego.setCookie("longitude",b.coords.longitude),console.info("Location successfully determined."),lego.setCookie("geoLocationError","false"),a()},function(){console.warn("During detection location the error occurred."),lego.setCookie("geoLocationError","true"),b()}):(console.warn("During detection location the error occurred."),lego.setCookie("geoLocationError","true"),b())},lego.chcontainer_init=function(){$(".b-chcontainer__item_loc").click(function(){return $(".b-chcontainer__item__img_geoloc").attr("src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTAiIGhlaWdodD0iMTEwIj48Y2lyY2xlIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI1NS4xMzgiIGN5PSI1Ni4xMTciIHI9IjQxLjMwNCIgZmlsbD0ibm9uZSIvPjxsaW5lIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSIxOC44NzUiIHkxPSI1Ni4xMzUiIHgyPSI0Ljg3NSIgeTI9IjU2LjEzNSIgZmlsbD0ibm9uZSIvPjxsaW5lIHN0cm9rZT0iIzRENEQ0RCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSI5MS44NzUiIHkxPSI1Ni4xMzUiIHgyPSIxMDQuODc1IiB5Mj0iNTYuMTM1IiBmaWxsPSJub25lIi8+PGxpbmUgc3Ryb2tlPSIjNEQ0RDREIiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjU0Ljg3NSIgeTE9IjE5LjEzNSIgeDI9IjU0Ljg3NSIgeTI9IjYuMTM1IiBmaWxsPSJub25lIi8+PGxpbmUgc3Ryb2tlPSIjNEQ0RDREIiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjU0Ljg3NSIgeTE9IjkzLjEzNSIgeDI9IjU0Ljg3NSIgeTI9IjEwNi4xMzUiIGZpbGw9Im5vbmUiLz48Y2lyY2xlIGZpbGw9IiNmMDAiIHN0cm9rZT0iI2YwMCIgc3Ryb2tlLXdpZHRoPSIuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgY3g9IjU1LjEzOCIgY3k9IjU2LjExNyIgcj0iMTcuMzkxIi8+PC9zdmc+"),void 0===lego.getCookie("latitude")||void 0===lego.getCookie("longitude")?lego.geoLocation(function(){document.location.href="/location"},function(){document.location.href="/location"}):(lego.setCookie("geoLocationError","false"),document.location.href="/location"),!1}),$(".b-chcontainer__item_search").click(function(){return $(".b-chcontainer__item_search").addClass("b-chcontainer__item_invis"),$(".b-chcontainer__item__form").addClass("b-chcontainer__item_vis"),!1})},lego.search_init=function(){var a=lego.getURLParameter("q");$(".b-search__q").text(a),document.searchf.q.value=a,$.getJSON("http://api.openweathermap.org/data/2.5/find?mode=json&type=like&units=metric&appid=39236d7efbea4f7c0fda3217a63c177b&q="+a+"&callback=?").done(function(a){200==a.cod?($(".b-weather__locname_city").text(a.name),0===a.count?lego.search_error():1===a.count&&(document.location.href="/city/"+a.list[0].id),$.each(a.list,function(a,b){var c='<div class="b-wlist__line"><div class="b-wlist__line__head"><a class="b-wlist__link" href="/city/{itemid}">{itemname}<a/> <span class"b-wlist__country">{itemcountry}</span></div><div class="b-wlist__line__content"><span class="b-wlist__temp">{itemtemp}℃</span> <span class="b-wlist__sky">{itemweather}</span></div></div>',d=c.replace("{itemid}",b.id).replace("{itemname}",b.name).replace("{itemcountry}",b.sys.country).replace("{itemtemp}",b.main.temp).replace("{itemweather}",b.weather[0].main);$(d).appendTo(".b-wlist")}),$(".b-loader").hide()):(console.warn("data error"),lego.search_error())}).fail(function(a,b,c){lego.search_error();var d=b+", "+c;console.log("Request Failed: "+d)})},lego.search_error=function(){$('<div class="b-wlist__error">Nothing was found. <a class="b-wlist__error__link" href="/">Geolocation?</a></div>').appendTo(".b-wlist"),$(".b-wlist__error__link").click(function(){lego.geoLocation()}),$(".b-loader").hide()},lego.mapLoad=function(a,b,c){google.maps.event.addDomListener(window,"load",lego.mapInit(a,b,c))},lego.mapInit=function(a,b,c){var d={zoom:13,center:new google.maps.LatLng(a,b),disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.TERRAIN};lego.mapInitParams=new google.maps.Map(document.getElementById(c),d)},lego.windParse=function(a,b){return a>=350&&10>a?"Wind north "+b+"m/s":a>=10&&20>a?"Wind north northeast "+b+"m/s":a>=20&&70>a?"Wind northeast "+b+"m/s":a>=70&&80>a?"Wind east northeast "+b+"m/s":a>=80&&100>a?"Wind east "+b+"m/s":a>=110&&160>a?"Wind east southeast "+b+"m/s":a>=160&&170>a?"Wind southeast "+b+"m/s":a>=170&&190>a?"Wind south "+b+"m/s":a>=190&&200>a?"Wind south southwest "+b+"m/s":a>=200&&250>a?"Wind southwest "+b+"m/s":a>=250&&260>a?"Wind west southwest "+b+"m/s":a>=260&&280>a?"Wind west "+b+"m/s":a>=280&&290>a?"Wind northwest west "+b+"m/s":a>=290&&340>a?"Wind northwest "+b+"m/s":a>=340&&350>a?"Wind north northwest "+b+"m/s":(console.warn("windParse error"),"")},lego.weather_city=function(){var a=window.location.pathname.split("/"),b=a[2];$.getJSON("http://api.openweathermap.org/data/2.5/weather?mode=json&units=metric&appid=39236d7efbea4f7c0fda3217a63c177b&id="+b+"&callback=?").done(function(a){if(200==a.cod){var b='<span class="b-weather__locname_city">{city}</span><span class="b-weather__locname_country">{country}</span>',c=b.replace("{city}",a.name).replace("{country}",a.sys.country),d='<div class="b-weather-now__data"><div class="b-weather-now__data__main"><span class="b-weather-now__data__main_temp">{temp}℃</span><span class="b-weather-now__data__main_sky"><span class="b-weather-now__data__main_sky_descr">{sky}</span><span class="b-weather-now__data__main_sky_fdescr"> {sky-text}</span></span></div><div class="b-weather-now__data__wind b-weather-now__data_sec"><span class="b-weather-now__data__wind_val">{wind}</span></div><div class="b-weather-now__data__pres b-weather-now__data_sec"><span class="b-weather-now__data__pres_val">Pressure {pressure} hPa</span></div><div class="b-weather-now__data__hum b-weather-now__data_sec"><span class="b-weather-now__data__hum_val">Humidity {humidity}%</span></div></div>',e=d.replace("{temp}",a.main.temp.toFixed(1)).replace("{sky}",a.weather[0].main).replace("{sky-text}",a.weather[0].description).replace("{wind}",lego.windParse(a.wind.deg,a.wind.speed)).replace("{pressure}",a.main.pressure).replace("{humidity}",a.main.humidity);$(".b-loader").hide(),$(e).appendTo(".b-weather-now"),$(c).appendTo(".b-weather__locname"),lego.mapLoad(a.coord.lat,a.coord.lon,"b-map")}else console.warn("data error"),lego.error(1)}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)}),$.getJSON("http://api.openweathermap.org/data/2.5/forecast/daily?mode=json&units=metric&appid=39236d7efbea4f7c0fda3217a63c177b&cnt=10&id="+b+"&callback=?").done(function(a){200==a.cod&&$.each(a.list,function(a,b){var c=new Date(1e3*b.dt),d={day:c.getDate(),month:c.getMonth()+1,monthtxt:""};switch(d.month){case 1:d.monthtxt="January";break;case 2:d.monthtxt="February";break;case 3:d.monthtxt="March";break;case 4:d.monthtxt="April";break;case 5:d.monthtxt="May";break;case 6:d.monthtxt="June";break;case 7:d.monthtxt="July";break;case 8:d.monthtxt="August";break;case 9:d.monthtxt="September";break;case 10:d.monthtxt="October";break;case 11:d.monthtxt="November";break;case 12:d.monthtxt="December";break;default:d.monthtxt="<!-- Error -->"}var e='<div class="b-weather-forecast__line"><div class="b-weather-forecast__section b-weather-forecast__section_date">{date}</div><div class="b-weather-forecast__section b-weather-forecast__section_content"><span class="b-weather-forecast__section__item b-weather-forecast__main">{main}</span><span class="b-weather-forecast__section__item b-weather-forecast__temp"><span class="b-weather-forecast__temp_max">↑{temp-max}</span> <span class="b-weather-forecast__temp_min">↓{temp-min}</span></span><span class="b-weather-forecast__section__item b-weather-forecast__wind">{wind}</span></div></div>',f=e.replace("{date}",'<span class="b-weather-forecast__section__item b-weather-forecast__section__day">'+d.day+"</span>").replace("{temp-max}",b.temp.max.toFixed(1)+"℃").replace("{temp-min}",b.temp.min.toFixed(1)+"℃").replace("{main}",b.weather[0].main).replace("{wind}",lego.windParse(b.deg,b.speed));$(f).appendTo(".b-weather-forecast")})}).fail(function(a,b,c){var d=b+", "+c;console.log("Request #2 Failed: "+d)}),lego.weather_select()},lego.weather_location=function(){var a={lat:lego.getCookie("latitude"),lon:lego.getCookie("longitude"),error:lego.getCookie("geoLocationError")};(void 0===a.lat||void 0===a.lon)&&lego.geoLocation(),"true"!=a.error?($.getJSON("http://api.openweathermap.org/data/2.5/weather?mode=json&units=metric&appid=39236d7efbea4f7c0fda3217a63c177b&lat="+a.lat+"&lon="+a.lon+"&callback=?").done(function(b){if(200==b.cod){var c='<span class="b-weather__locname_city">{city}</span><span class="b-weather__locname_country">{country}</span>',d=c.replace("{city}",b.name).replace("{country}",b.sys.country),e='<div class="b-weather-now__data"><div class="b-weather-now__data__main"><span class="b-weather-now__data__main_temp">{temp}℃</span><span class="b-weather-now__data__main_sky"><span class="b-weather-now__data__main_sky_descr">{sky}</span><span class="b-weather-now__data__main_sky_fdescr"> {sky-text}</span></span></div><div class="b-weather-now__data__wind b-weather-now__data_sec"><span class="b-weather-now__data__wind_val">{wind}</span></div><div class="b-weather-now__data__pres b-weather-now__data_sec"><span class="b-weather-now__data__pres_val">Pressure {pressure} hPa</span></div><div class="b-weather-now__data__hum b-weather-now__data_sec"><span class="b-weather-now__data__hum_val">Humidity {humidity}%</span></div></div>',f=e.replace("{temp}",b.main.temp.toFixed(1)).replace("{sky}",b.weather[0].main).replace("{sky-text}",b.weather[0].description).replace("{wind}",lego.windParse(b.wind.deg,b.wind.speed)).replace("{pressure}",b.main.pressure).replace("{humidity}",b.main.humidity);$(".b-loader").hide(),$(d).appendTo(".b-weather__locname"),$(f).appendTo(".b-weather-now"),lego.mapLoad(a.lat,a.lon,"b-map")}else console.warn("data error"),lego.error(1)}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)}),$.getJSON("http://api.openweathermap.org/data/2.5/forecast/daily?mode=json&units=metric&appid=39236d7efbea4f7c0fda3217a63c177b&cnt=10&lat="+a.lat+"&lon="+a.lon+"&callback=?").done(function(a){200==a.cod&&$.each(a.list,function(a,b){var c=new Date(1e3*b.dt),d={day:c.getDate(),month:c.getMonth()+1,monthtxt:""};switch(d.month){case 1:d.monthtxt="January";break;case 2:d.monthtxt="February";break;case 3:d.monthtxt="March";break;case 4:d.monthtxt="April";break;case 5:d.monthtxt="May";break;case 6:d.monthtxt="June";break;case 7:d.monthtxt="July";break;case 8:d.monthtxt="August";break;case 9:d.monthtxt="September";break;case 10:d.monthtxt="October";break;case 11:d.monthtxt="November";break;case 12:d.monthtxt="December";break;default:d.monthtxt="<!-- Error -->"}var e='<div class="b-weather-forecast__line"><div class="b-weather-forecast__section b-weather-forecast__section_date">{date}</div><div class="b-weather-forecast__section b-weather-forecast__section_content"><span class="b-weather-forecast__section__item b-weather-forecast__main">{main}</span><span class="b-weather-forecast__section__item b-weather-forecast__temp"><span class="b-weather-forecast__temp_max">↑{temp-max}</span> <span class="b-weather-forecast__temp_min">↓{temp-min}</span></span><span class="b-weather-forecast__section__item b-weather-forecast__wind">{wind}</span></div></div>',f=e.replace("{date}",'<span class="b-weather-forecast__section__item b-weather-forecast__section__day">'+d.day+"</span>").replace("{temp-max}",b.temp.max.toFixed(1)+"℃").replace("{temp-min}",b.temp.min.toFixed(1)+"℃").replace("{main}",b.weather[0].main).replace("{wind}",lego.windParse(b.deg,b.speed));$(f).appendTo(".b-weather-forecast")})}).fail(function(a,b,c){var d=b+", "+c;console.log("Request #2 Failed: "+d)})):(lego.error(0),console.warn("Geolocation error")),lego.weather_select()},lego.weather_select=function(){"#forecast"==window.location.hash&&($(".b-weather-select__item_forecast").addClass("b-weather-select__item_active"),$(".b-weather-select__item_now").removeClass("b-weather-select__item_active"),$(".b-weather-forecast").addClass("b-weather_active"),$(".b-weather-now").removeClass("b-weather_active"),$(".b-footer").addClass("b-footer_st")),$(".b-weather-select__item_now").click(function(){$(this).addClass("b-weather-select__item_active"),$(".b-weather-select__item_forecast").removeClass("b-weather-select__item_active"),$(".b-weather-now").addClass("b-weather_active"),$(".b-weather-forecast").removeClass("b-weather_active"),$(".b-footer").removeClass("b-footer_st")}),$(".b-weather-select__item_forecast").click(function(){$(this).addClass("b-weather-select__item_active"),$(".b-weather-select__item_now").removeClass("b-weather-select__item_active"),$(".b-weather-forecast").addClass("b-weather_active"),$(".b-weather-now").removeClass("b-weather_active"),$(".b-footer").addClass("b-footer_st")})};